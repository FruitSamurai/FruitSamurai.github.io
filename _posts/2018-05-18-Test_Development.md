---
layout: post
title: "TestNG+Groovy进行接口测试"
tags: [code]
---
如果你已经了解了TestNG和Groovy的基本用法，并且在本地配置好了测试框架的环境，下一步的工作就是如何进行接口测试的开发了。  

### 开发接口测试代码 ###
* 阅读接口wiki
* 了解需求额
* 设计测试用例或者已有测试用例的基础上，将测试用例转化为代码

#### 阅读接口wiki ####
阅读接口wiki，如果是新增接口或者接口入参请求方法等有改动，需要手动去更新项目里面这个接口的定义文件，然后执行ApiClassGenerator类的main方法生成或者更新main里面的接口类。
#### 了解需求 ####
做过功能测试的都比我了解某个功能的需求，所以这个就不说了。
#### 设计测试用例，将测试用例转化为代码 ####
以现金理财现金产品登记这个接口测试为例，做一下说明。首先阅读现金产品登记的wiki，更新或者新增对用的接口类。了解现金产品登记这个接口在佣金宝APP里面的哪个功能页面调用的。如果一个资金账号没有购买过现金理财产品的话，或者某个资金账号曾经购买过现金理财产品后来通过其他途径注销掉了，当这个资金账号想要购买现金理财产品的话，我们需要对这个现金理财产品进行登记，就需要调用现金理财产品登记这个接口。现金理财产品登记的过程需要做两件事情，1是开基金户，2是绑定金腾通。因此如果一个资金账号已有基金户的话，调用登记接口应该是直接返回登记成功的，并且如果是交易时间内的话，可以申购金腾通现金理财。如果资金账号没有基金户，则需要T+1日才能确认基金户，T+2日才能登记确认。此时如果使用现金理财的status接口去查询有基金户的资金账号的状态应该是登记成功，而没有基金户的客户的状态是基金户未确认。
基于以上分析，首先需要构造出两种资金账号，一种是有基金户的资金账号一种是没有基金户的资金账号。由于在别的接口测试中可能也会用到这两种状态的资金账号，因此最好分别对应一个SQL模板，使用SqlEnumGenerator类将SQL模板生成查询数据库的接口，然后在测试类中生成DataProvider供测试方法调用。